# Neon <!-- omit in toc -->

Atomi's design system.

[![CircleCI](https://circleci.com/gh/hschub/neon.svg?style=shield&circle-token=b13d11d6ef5b342f1fddb6b524b24408ff306cf7)](https://circleci.com/gh/hschub/neon)
[![Commitizen
friendly](https://img.shields.io/badge/commitizen-friendly-brightgreen.svg)](http://commitizen.github.io/cz-cli/)
[![semantic-release](https://img.shields.io/badge/%20%20%F0%9F%93%A6%F0%9F%9A%80-semantic--release-e10079.svg)](https://github.com/semantic-release/semantic-release)

## Table of contents <!-- omit in toc -->

- [Development](#development)
  - [Installation](#installation)
  - [Scripts](#scripts)
    - [`yarn new:component`](#yarn-newcomponent)
    - [`yarn new:util`](#yarn-newutil)
    - [`yarn dev`](#yarn-dev)
    - [`yarn cz`](#yarn-cz)
    - [`yarn lint`](#yarn-lint)
    - [`yarn compile`](#yarn-compile)
    - [`yarn build`](#yarn-build)
    - [`yarn types:check`](#yarn-typescheck)
    - [`yarn types:declarations`](#yarn-typesdeclarations)
    - [`yarn prettier:diff`](#yarn-prettierdiff)
    - [`yarn precommit`](#yarn-precommit)
    - [`yarn test`](#yarn-test)
    - [`yarn test:percy`](#yarn-testpercy)
  - [Publishing](#publishing)
  - [SVG's](#svgs)
    - [Grouping](#grouping)
    - [Add SVG(s)](#add-svgs)
    - [Consumer components](#consumer-components)

## Development

### Installation

Some of our NPM packages are saved in private repositories. You'll need to add the read-only token saved in 1Password Secured Notes into your `.npmrc` file.
If it's your first time using an NPM configuration file, create the file under your HOME folder (e.g
`~/.npmrc`) with the following:

```
//registry.npmjs.org/:_authToken=token-copied-from-1password
```

```bash
# clone the repo
$ git clone git@github.com:hschub/neon.git neon

# install dependencies
yarn
```

### Scripts

#### `yarn new:component`

Scaffold a new component. Follow the prompts in the wizard.

#### `yarn new:util`

Scaffold a new utility module. Follow the prompts in the wizard.

#### `yarn dev`

We use [Storybook](https://storybook.js.org/) to document our components and provide an environment for rapid feedback when building them. The server is started on <http://localhost:6006>.

#### `yarn cz`

Conform to the [Conventional
Commits](https://conventionalcommits.org/) specification on each commit.

**✋ Commits of _type_ `fix` or `feat` or if `BREAKING CHANGE` is in the commit
body a new release will be triggered (see
[Publishing](#publishing) for more information).**

#### `yarn lint`

- Lint all CSS files within the `src` folder against Atomi's [`stylelint`](https://stylelint.io/) configuration. Use `yarn lint:css` for this task only.
- Lint all JavaScript files within the `src` folder against [Atomi's ESLint
  configuration](https://github.com/hschub/eslint-config-atomi) (see [Atomi's
  JavaScript
  Styleguide](https://github.com/hschub/style-guides/blob/master/javascript.md)).
  Use `yarn lint:js` for this task only.

**✋ Will run automatically as part of [`CI`](#ci) and the precommit hook.**

#### `yarn compile`

Prepare a new version of the library saving it to the `dist` folder. This is
what consumers of the library interact with, i.e., the contents of the
[`@getatomi/neon`](https://www.npmjs.com/package/@getatomi/neon) NPM package.
The following tasks are performed:

- Clean the `dist` folder.
- Transpile the source code into [CommonJS modules](http://requirejs.org/docs/commonjs.html), [ES modules](https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/) and CSS using [Rollup](https://rollupjs.org) and [SWC](https://swc.rs).

**✋ Will run automatically as part of [`CI`](#ci).**

#### `yarn build`

Creates a static Storybook build which is then deployed to [Heroku](https://www.heroku.com/).

**✋ Will run automatically as part of [`CI`](#ci).**

#### `yarn types:check`

`yarn types:check` will run the TypeScript compiler against the codebase and
identify any type errors.

Most IDE's (such as VSCode) will automatically check types as you work, so
manually running the above is generally not required.

**✋ `yarn types:check` will run automatically as part of the precommit hook.**

#### `yarn types:declarations`

Generates TypeScript type declarations files in the `dist/types` folder. These
will be shipped as part of the neon bundle so that consuming apps can benefit
from typechecking.

It uses `tsc` to emit the types declarations and
[tsc-alias](https://github.com/justkey007/tsc-alias) to rewrite all the aliased
paths (`tsc` doesn't handle aliases in type declarations).

**✋ `yarn types:declarations` will run automatically after running `yarn compile`.**

#### `yarn prettier:diff`

Print the filenames of files that are different from
[Prettier](https://prettier.io) formatting. If there are differences the script errors out.

**✋ Will run automatically as part of [`CI`](#ci).**

#### `yarn precommit`

Perform a series of tasks using
[`lint-staged`](https://github.com/okonet/lint-staged) which are
automatically triggered when performing a git commit ([`yarn cz`](#yarn-commit)). The following tasks are performed:

- Prettier via [`prettier-eslint-cli`](https://github.com/prettier/prettier-eslint-cli) and [`prettier-stylelint`](https://github.com/hugomrdias/prettier-stylelint).
- Linting via `eslint` and `stylelint` (see [`yarn lint`](#yarn-lint)).
- Unit tests (see [`yarn test`](#yarn-test))

#### `yarn test`

Run all unit tests using [Jest](https://facebook.github.io/jest/). For "watch"
mode use `yarn test:watch` and for coverage use `yarn test:coverage`.

**✋ Will run automatically as part of [`CI`](#ci).**

#### `yarn test:percy`

Run [Storybook](https://storybook.js.org/) and take snapshots of selected stories with [Percy](https://percy.io/). Due to the large number of screenshots generated – if we were to snapshot every story at every breakpoint – we would generate thousands of screenshots for a single run.
Marking stories for snapshots is done by adding the word `snapshot` the story name.

To run Percy locally, you need to create a `.env` file in the root containing:

```
PERCY_TOKEN=xxx
```

or run `PERCY_TOKEN=xxx yarn test:percy`.

### Publishing

Publishing is automated with [semantic-release](https://github.com/semantic-release/semantic-release). `semantic-release` uses the commit messages to determine the type of changes and update the version in `package.json` as well as filling the changelog accordingly.

Publishing happens automatically in CI when a feature branch is merged into the master branch.

To manually publish a beta version, for example to test a change in a consumer application:

1. Update the version in package.json e.g `"version": "10.9.4-PROD-XXX.0"`. The associated JIRA ticket is included in the version to avoid conflicts and keep track of the different beta versions. Increment the `.0` (e.g. `10.9.4-PROD-XXX.1`) to publish a revision on the same JIRA ticket ID.
2. Run `npm publish`.

### SVG's

Neon uses [SVGR](https://github.com/smooth-code/svgr) to convert `.svg` files
into React components.

#### Grouping

All of Neon's SVG's fit into one of the following groups:

- **Icons**
  - `.svg` location: `src/assets/images/svgs/icons`
  - `.js` location (React component): `src/components/private/Icon/svgs`
  - Source file location (Google Drive): Ask in #design-system channel.
- **Illustrations**
  - `.svg` location: `src/assets/images/svgs/illustrations`
  - `.js` location (React component): `src/components/public/Illustration/svgs`
  - Source file location (Google Drive): Ask in #design-system channel.

**✋ The `.js` files are automatically generated therefore do not edit them.**

#### Add SVG(s)

1. Grab the source file(s) from Google Drive and put into the relevant `.svg`
   location (see [Grouping](#grouping)). Make sure the filename(s) follow these structures:

   - **Illustration:** `illustration-[category]-[name].svg`.
   - **Icon:** `icon-[name].svg`.

     _These filename rules will eventually exist in a Confluence doc._

2. Run the relevant `svgr:` script to convert the `.svg` file(s) into React component(s).

#### Consumer components

Every generated **illustration** and **icon** component is wrapped with the
`<Illustration />` and `<Icon />` components which are the components a Neon consumer interacts with.
